<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>H264 on av.community</title>
    <link>/tags/h264/index.4537d42d.xml</link>
    <description>Recent content in H264 on av.community</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="/tags/h264/index.4537d42d.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Advanced x264 Encoding Guide</title>
      <link>/guides/advanced-x264-encoding/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/guides/advanced-x264-encoding/</guid>
      <description>

&lt;h2 id=&#34;getting-to-know-your-x264&#34;&gt;Getting to Know Your x264&lt;/h2&gt;

&lt;p&gt;x264 is a harsh mistress. Despite mostly being used to compress movies, it is for some reason highly optimized for anime tentacle porn. On top of that, there is no built-in gui for beginners and the available documentation seems only to exist so that it may taunt and humiliate the average person. Well fear not! Even though I haven&amp;rsquo;t encoded anything for the site in probably over a year, I&amp;rsquo;m here to guide you through (most of) x264&amp;rsquo;s meaningful parameters so you can become better at encoding. And as a bonus, writing this will keep the staff from demoting me to a userclass where the rest of you filthy swine reside. So, without further ado&amp;hellip;&lt;/p&gt;

&lt;h2 id=&#34;ref&#34;&gt;Ref&lt;/h2&gt;

&lt;p&gt;This is a no-brainer parameter that requires no testing but is critical for yielding the highest possible quality without breaking standalone device (Popcorn Hour, WDTV Live, Roku) playback. Taken directly from the HD encoding guide:&lt;/p&gt;

&lt;p&gt;Once you have cropped your source in AvsPmod or whatever other script editor you are using, take the equation 8388608 / (width after cropping x height after cropping), inputting your source&amp;rsquo;s width and height in what I hope are obvious enough placeholders. Take the result and round it down to the nearest whole number. This is the number you are to use for the &lt;code&gt;--ref&lt;/code&gt; setting.&lt;/p&gt;

&lt;p&gt;If you use a number larger than what the formula yields for a 720p or 1080p encode, it will still play but will only look slightly better and will not play on standalone devices.&lt;/p&gt;

&lt;p&gt;If you are encoding to a Standard Definition resolution (i.e. smaller than 720p), you may skip the math and simply use 16 as your ref number.&lt;/p&gt;

&lt;p&gt;Keep in mind that by design, you cannot use a number larger than 16 here.&lt;/p&gt;

&lt;h2 id=&#34;b-frames&#34;&gt;B-frames&lt;/h2&gt;

&lt;p&gt;B-frames have a fair amount of control over the compressibility (size) of your encode. More bframes = longer encoding time but also smaller file sizes. But you cannot exactly force more bframes into an encode if x264 decides it doesn&amp;rsquo;t need them&amp;hellip; well, not without using b-bias and catastrophically breaking things. Anyway, the ideal number of b-frames needed for an encode can be determined in a single test encode. And by &amp;lsquo;single&amp;rsquo; I mean you&amp;rsquo;ll need to use the avisynth filter SelectRangeEvery() to grab a few thousand frames to test using &lt;code&gt;--bframes 16&lt;/code&gt;. x264 will spit out a log file when the test encode is done. Somewhere in this log will be a line that looks like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;x264 [info]: consecutive B-frames: 0.5% 1.1% 3.6% 24.0% 14.4% 43.3% 4.0% 3.4% 1.1% 1.4% 0.5% 0.9% 0.3% 0.3% 0.2% 0.9% 0.1%
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;There are 17 values listed. Each one represents a specific number of b-frames, from 0 to 16. Each value shows the percentage of total frames that were able to make use of that number of consecutive b-frames. From these numbers I usually select the largest one ≥ 1.0% but have made exceptions for 0.9% values.&lt;/p&gt;

&lt;h2 id=&#34;crf-and-2-pass&#34;&gt;CRF and 2-Pass&lt;/h2&gt;

&lt;p&gt;Whether you choose to encode crf or 2-pass, this setting will have the most significant impact on your encode&amp;rsquo;s overall quality. With 2-pass, you choose a bitrate. With crf you choose a quality level in the form of a numerical rate factor. The bitrate/quality will vary throughout the extent of whatever you are encoding, but will average out to whatever your input for this value was.&lt;/p&gt;

&lt;p&gt;CRF and 2-pass use the exact same algorithm and therefore there is literally no advantage to using one over the other. If a crf 20 encode gives you an average bitrate of 6000 kbps, a 2-pass encode @ 6000 kbps will yield the exact same quality. Additionally, the log from the first pass of a 2-pass encode will give you the equivalent rate factor one would use for a crf encode.&lt;/p&gt;

&lt;p&gt;Again, there is NO advantage to either method. Many people prefer 2-pass due to not fully understanding how to use the next setting I&amp;rsquo;ll go over. Others will do test encodes with both crf and 2-pass to achieve ideal quality. My preference happens to be crf, but only because I feel that bitrate / filesize should be irrelevant and picture quality should never be compromised. Then again, everything I&amp;rsquo;ve ever encoded is like 400 GB&amp;hellip;&lt;/p&gt;

&lt;p&gt;Reasonable bitrates for 2-pass/crf will vary depending on your source and a few other settings. I can&amp;rsquo;t say much on bitrate, but crf should nearly always be between 16 and 23.&lt;/p&gt;

&lt;h2 id=&#34;qcomp&#34;&gt;QComp&lt;/h2&gt;

&lt;p&gt;While crf and 2-pass affect the overall quality of the encode, qcomp affects how crf and 2-pass are applied. Next to crf/2-pass it is the most important x264 parameter for afecting the quality of your final encode. qcomp will always be a number between 0.0 and 1.0. At 0.0, your crf number or 2-pass bitrate will yield a constant bitrate throughout the entire encode. At 1.0, the encode&amp;rsquo;s bitrate variance is completely uncapped and so will flail around like a crack-addicted preschooler.&lt;/p&gt;

&lt;p&gt;The default is 0.6 but for live-action should be bumped to 0.7, or 0.75 for sources with a lot of grain/noise. For lower quality sources with little or no grain, low-quality animation or dark movies without much grain you can try around 0.55 or 0.5. Essentially the viable qcomp range for any source will be (roughly) 0.45 - 0.75.&lt;/p&gt;

&lt;p&gt;This is a setting where testing multiple values is definitely worth it.&lt;/p&gt;

&lt;h2 id=&#34;me-and-merange&#34;&gt;ME and MERange&lt;/h2&gt;

&lt;p&gt;ME (Motion estimation) and MERange (Motion estimation range) help x264 predict motion across frames and compress at a higher level of quality based on the information these two parameters allow it to gather. The higher the quality of the motion estimation algorithm and the higher the motion estimation range, the greater the quality yielded. BUT this also means increased encoding time. Also, as expected, you&amp;rsquo;ll begin to see diminishing returns with respect to quality as you increase these two parameters.&lt;/p&gt;

&lt;p&gt;For our purposes however, these two parameters are dead simple. If your computer has an older/slower processor, use &lt;code&gt;--me umh --merange 24&lt;/code&gt;. These were determined to be the best tradeoff between quality and encoding time, and umh is highly capable of yielding the kind of quality you should be striving for. However, for those of you with faster hardware that want a bit more quality: &lt;code&gt;--me tesa --merange 16&lt;/code&gt; is the final word here.&lt;/p&gt;

&lt;h2 id=&#34;aq-mode&#34;&gt;AQ-Mode&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;--aq-mode&lt;/code&gt; affects how the next setting we&amp;rsquo;ll discuss, &lt;code&gt;--aq-strength&lt;/code&gt;, is applied. There are three options available to you. &lt;code&gt;--aq-mode 2&lt;/code&gt; was supposed to replace mode 1, but is one of those things that appears to have been optimized at least slightly for anime tentacle porn. Mode 2 should work better on lower quality sources or those that have very little grain. For everything else, you&amp;rsquo;ll want to use &lt;code&gt;--aq-mode 1&lt;/code&gt;. It&amp;rsquo;s not perfect but as of right now there is no better alternative. It works well enough. Please note that &lt;code&gt;--aq-mode 0&lt;/code&gt; disables &lt;code&gt;--aq-strength&lt;/code&gt; entirely and should never be used.&lt;/p&gt;

&lt;h2 id=&#34;aq-strength&#34;&gt;AQ-Strength&lt;/h2&gt;

&lt;p&gt;In any given frame, x264 gives priority (more bitrate) to higher-quality macroblocks. &lt;code&gt;--aq-strength&lt;/code&gt; determines the magnitude of that priority. 1.00 is the default. Anything above 1.00 will, increasingly, give more and more priority to lower-quality macroblocks. Lower than 1.00 will give more priority to higher-quality macroblocks. Generally everything you encode should have an &lt;code&gt;--aq-strength&lt;/code&gt; between 0.50 and 1.30.&lt;/p&gt;

&lt;p&gt;Higher quality sources and sources with more grain/noise will benefit from lower &lt;code&gt;--aq-strength&lt;/code&gt; values.&lt;/p&gt;

&lt;p&gt;Lower quality sources, non-HD sources, etc should benefit more from higher values.&lt;/p&gt;

&lt;h2 id=&#34;mbtree&#34;&gt;MBTree&lt;/h2&gt;

&lt;p&gt;While most of what x264 does handles compression within a given frame, mbtree looks to compress information across frames. Yet another x264 parameter dreamt up to improve anime tentacle porn compression, mbtree is a solid idea that actually performs quite poorly on most higher quality live-action sources.&lt;/p&gt;

&lt;p&gt;This parameter is enabled by default but can be turned off with &lt;code&gt;--no-mbtree&lt;/code&gt;. MBTree should be turned off for any source with even a modest amount of grain/noise. It will help on lower-quality sources, many DVDs, anything shot on a digital camera (The Social Network, District 9, etc), but due to the somewhat random nature of video grain, will significantly increase an encode&amp;rsquo;s bitrate if the source was grainy/noisy.&lt;/p&gt;

&lt;p&gt;RC-Lookahead is another x264 setting that directly affects how many frames mbtree takes into consideration during an encode. This is important as mbtree is known for performing badly in scene fades (fading to or from black). To mitigate this, I recommend using &lt;code&gt;--rc-lookahead 250&lt;/code&gt; on literally every encode you do that uses mbtree. The only downside to this is that if your computer has 2 GB of memory or less, it will be somewhat unusable during the encoding process.&lt;/p&gt;

&lt;p&gt;It should be noted that qcomp affects how mbtree is applied, but not in a way that your usage of mbtree should affect your decisions with qcomp in any way whatsoever.&lt;/p&gt;

&lt;h2 id=&#34;psy-rdo-and-psy-trellis&#34;&gt;Psy-RDO and Psy-Trellis&lt;/h2&gt;

&lt;p&gt;These two settings are controlled by a single parameter, in the format &lt;code&gt;--psy-rd x.xx:y.yy&lt;/code&gt;. Psy-RDO is x.xx and Psy-Trellis is y.yy Psy-RDO should be used on any source that isnt completely devoid of grain. Psy-Trellis is an unwieldy bastard that can either save a reasonable amount of bitrate or destroy picture quality.&lt;/p&gt;

&lt;p&gt;Technically, psy-rdo lowers picture quality on a mathematical level. But it also applies a layer of noise to the encode in a way that increases the perceived complexity of the video. Given that noise/grain in any given source is somewhat random to begin with, this is actually a good thing. It increases the visually perceived quality level while allowing the overall bitrate/filesize to be decreased.&lt;/p&gt;

&lt;p&gt;Psy-rdo also assumes that grain was applied evenly throughout each frame in the source. Psy-trellis does not, and is useful if you have a source where parts of a frame are grainier than others. If you can look through a source and see that grain is blanketed evenly throughout each frame, it is probably better to keep psy-trellis disabled. Otherwise, you should test psy-trellis.&lt;/p&gt;

&lt;p&gt;Psy-RDO is mostly just about grain matching. For most live-action, generally a value between 0.90 and 1.30 will suffice. For most animation, 0.50 to 0.90 is a good testing range. Once you have found your source&amp;rsquo;s ideal psy-rdo value, you can test psy-trellis. I recommend running 6 test encodes with psy trellis: 0.05, 0.10, 0.15, 0.20, 0.25 and 0.30. The 6 test encodes should be a few thousand frames long, again using SelectRangeEvery(), and should be compared against a test encode with psy-trellis disabled. If one of the encodes with psy-trellis enabled looks the best, leave that psy-trellis value but do a few tests with slight changes to psy-rdo.&lt;/p&gt;

&lt;h2 id=&#34;deblock&#34;&gt;Deblock&lt;/h2&gt;

&lt;p&gt;Deblock smooths out the blockiness that can occur in a lower-quality source or occasionally in a lower-quality x264 encode. Deblock consists of two numbers. The first number is the strength of the deblocking filter, and the second is the threshold at which the filter decides whether something is a block or detail that needs to be preserved. Generally you should use &lt;code&gt;--deblock -3,-3&lt;/code&gt; for everything that isnt a terrible quality source. You can go below &lt;code&gt;-3,-3&lt;/code&gt; (as low as &lt;code&gt;-6,-6&lt;/code&gt;) if you want, but I wouldn&amp;rsquo;t recommend that unless you&amp;rsquo;re a huge fan of placebos or your television is by far the most expensive thing you own.&lt;/p&gt;

&lt;h2 id=&#34;ssim&#34;&gt;SSIM&lt;/h2&gt;

&lt;p&gt;Adding &lt;code&gt;--ssim&lt;/code&gt; to your x264 parameters can be useful for test encodes. It will give you data on ssim/db which will give you a fairly accurate numerical representation of fidelity with respect to your source. This number becomes more useful when comparing multiple test encodes, and much less useful if the encode(s) used psy-rdo in any way. Please take note that when trying to reach visual transparency, db is a better choice over ssim simply for the fact that it follows a linear scale as it approaches 100% transparency, while ssim follows a logarithmic scale which by design devalues visual improvement increasingly as you approach transparency.&lt;/p&gt;

&lt;h2 id=&#34;vf&#34;&gt;VF&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;--vf&lt;/code&gt; aka video filter, is an early attempt at replacing core avisynth filters with filters built-in to x264. Avisynth is a critical part of video encoding but also a significant bottleneck in terms of encoding time and is the only real hurdle keeping x264 encoding from being viable on non-windows platforms. For practical purposes I will only discuss how using &lt;code&gt;--vf&lt;/code&gt; will improve encoding time:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;--vf crop:{left},{top},{right},{bottom}/resize:{width},{height},0:0,method=spline
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&amp;hellip;will allow you to crop and/or resize your source video without the need for using an AviSynth script. Do not use this parameter in your test encodes, only for the full encode. For the full movie encode, you will copy any cropping and resizing numbers from the &lt;code&gt;.avs&lt;/code&gt; test script to this parameter. Crop should always be before resize. Anything outside of brackets should be left the same. The / is for separating the crop and resize filters. If you do not need to resize the source video, omit the / and everything after it.&lt;/p&gt;

&lt;h2 id=&#34;minor-settings&#34;&gt;Minor Settings&lt;/h2&gt;

&lt;p&gt;The following settings, for now, probably don&amp;rsquo;t merit an in-depth explanation as they should remain the same for everything you encode:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;--b-pyramid normal&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;--no-dct-decimate&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;--analyse all&lt;/code&gt; / &lt;code&gt;--partitions all&lt;/code&gt; &amp;mdash; These two parameters are interchangeable. Many sites/guides still refer to this parameter when mentioning L4.1 (standalone device) compatibility. And while it is technically part of the L4.1 standard, no standalone device actually adheres to this portion of it. In other words, you can safely use &lt;code&gt;--analyse all&lt;/code&gt; / &lt;code&gt;--partitions all&lt;/code&gt; on every encode and still not break standalone device playback in any way.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;--direct auto&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;--b-adapt 2&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;--trellis 2&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;--no-fast-pskip&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;--subme 11&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;--no-weightb&lt;/code&gt; &amp;mdash; May help quality retention on CGI material. Otherwise, don&amp;rsquo;t use this parameter.&lt;/p&gt;

&lt;h2 id=&#34;final-notes&#34;&gt;Final Notes&lt;/h2&gt;

&lt;p&gt;Please consider this to be a (very) rough draft. If I made a mistake or left something out, let me know.
There are many parameters that you may have seen used in other encodes. More than likely these were attempts to limit overall bitrate and contribute nothing of value to the overall encode other than to keep the bottom-feeders from complaining about the file size.&lt;/p&gt;

&lt;p&gt;Some of the parameters&amp;rsquo; suggested testing ranges are rather large. In most of these I have specified where you can cut down on test encodes if you know enough about the type of source you have. In others I have intentionally left them &amp;lsquo;open&amp;rsquo; for the time being. Myself and several others are working on a thought-to-be-dead project to automate x264 test encoding, and much of what we will be doing in the near future will be geared towards slimming down the testing range and in effect eliminating a large number of test encodes required to reach visual transparency. In other words, this is a DRAFT so don&amp;rsquo;t bitch about the test ranges just yet.&lt;/p&gt;

&lt;h1 id=&#34;further-enhancements&#34;&gt;Further enhancements&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;Explain succinctly H.264 levels, and the whole CABAC or not CABAC deal&lt;/li&gt;
&lt;li&gt;Expand on how you can make an encode most compatible (what you mention about breaking device compatability)&lt;/li&gt;
&lt;li&gt;How the above relates to section 3.1 on the scene rules for x264 &lt;a href=&#34;http://scenerules.irc.gs/t.html?id=2011_X264.2.nfo&#34;&gt;http://scenerules.irc.gs/t.html?id=2011_X264.2.nfo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Use a couple of your encode strings as an example and explain why you chose them.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Source: &lt;a href=&#34;https://www.reddit.com/r/trackers/comments/wevh2/good_beginning_x264_reference_guide/?st=iykv0fdu&amp;amp;sh=6a965450&#34;&gt;https://www.reddit.com/r/trackers/comments/wevh2/good_beginning_x264_reference_guide/?st=iykv0fdu&amp;amp;sh=6a965450&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Encoding Video for Blu-ray Using H265 / AVC</title>
      <link>/guides/encoding-video-for-blu-ray-using-h264-avc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/guides/encoding-video-for-blu-ray-using-h264-avc/</guid>
      <description>&lt;p&gt;Source: &lt;a href=&#34;http://forum.doom9.org/showthread.php?t=154533&#34;&gt;http://forum.doom9.org/showthread.php?t=154533&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here is part of specification that apply when encoding with H264/AVC codec, all parameters showed here are not guessing, it&amp;rsquo;s based on original Blu-Ray specification, which are not available in public.&lt;/p&gt;

&lt;p&gt;NOTE: This is discussion about settings that are for creating 100% compliant Blu-Ray structures, not for encoding from Blu-Ray sources to matroska/mp4 or other media, if you encode to those skip this nightmare :)&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;GENERAL CONSTRAINTS FOR MPEG-4 H264/AVC&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;1.1 ALLOWED RESOLUTIONS/FRAMERATES&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://tom.niko.users.sbb.rs/resolutions.png&#34;&gt;http://tom.niko.users.sbb.rs/resolutions.png&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1.2 ALLOWED LEVELS, PROFILES, REFERENCE FRAMES, VBV&lt;/p&gt;

&lt;p&gt;1.2.1 Primary Video Rules&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://tom.niko.users.sbb.rs/gopsrefs2.png&#34;&gt;http://tom.niko.users.sbb.rs/gopsrefs2.png&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1.2.2 Secondary Video Rules&lt;/p&gt;

&lt;p&gt;NOTE: In case of 1080 and 720 resolutions same rules apply as Primary video, while 576 and 480 resolutions have stricter parameters showed in table:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://tom.niko.users.sbb.rs/gopsrefs3.png&#34;&gt;http://tom.niko.users.sbb.rs/gopsrefs3.png&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1.3 SIMPLE ASPECT RATIO&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://tom.niko.users.sbb.rs/sar.png&#34;&gt;http://tom.niko.users.sbb.rs/sar.png&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1.4 COLOR CHARACTERISTICS&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://tom.niko.users.sbb.rs/color.png&#34;&gt;http://tom.niko.users.sbb.rs/color.png&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1.5 OTHER REQUIRED PARAMETERS&lt;/p&gt;

&lt;p&gt;8-bit (4:2:0) Colorspace is only allowed
Main and High profiles are allowed
Maximum 3 B-Frames is allowed
NAL-HRD Type 2 capable encoder is needed&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;ENCODE BLU-RAY VIDEO USING x264&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;2.1 MANDATORY PARAMETERS&lt;/p&gt;

&lt;p&gt;Every encode for Blu-Ray must contain this parameters, without it will not meet Blu-Ray specification.&lt;/p&gt;

&lt;p&gt;&amp;ndash;bluray-compatEnforce x264 to create BD compliant stream, that will reduce x264 settings to BD compatible: bframe&amp;lt;=3, ref&amp;lt;=4 for 1080, ref&amp;lt;=6 for 720/576/480, bpyramid&amp;lt;=strict, weightp&amp;lt;=1, aud=1, nalhrd=vbr&lt;/p&gt;

&lt;p&gt;&amp;ndash;levelBlu-Ray level, see the table for the appropriate level&lt;/p&gt;

&lt;p&gt;&amp;ndash;keyintMaximum number displayed pictures in GOP. If you set Maximum bitrate less or equal to 15mbps you can use 2 second long GOP otherwise, 1 second GOP must be used.&lt;/p&gt;

&lt;p&gt;&amp;ndash;vbv-maxrateMaximum allowed bitrate. Depend of destination media, for normal BD Media, maximum settings is allowed (40000), while for DVD Media (eg BD-5 or BD-9) there is no maximum per Blu-Ray specification, but is strongly recommended that use less or equal to 15000, since DVD reading is slower.&lt;/p&gt;

&lt;p&gt;&amp;ndash;vbv-bufsizeMaximum allowed buffer, buffer size is in relation with maxrate. Since STD Buffer Delay for Blu-Ray allows maximum 1 second. This mean to divide buffer with maxrate and see if result is less or equal to 1, if not, buffer is need to be reduced to lower value that meet 1 second STD. For BD media, maximum settings is allowed (30000), but if not meet STD Buffer Delay, then need to be reduced to lower value. For DVD media there is no maximum in Blu-Ray specification, but is strongly recommended that use less or equal to 15000, and again need to meet STD delay of 1 second.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;p&gt;&amp;ndash;vbv-bufsize 30000 &amp;ndash;vbv-maxrate 40000 is allowed
&amp;ndash;vbv-bufsize 30000 &amp;ndash;vbv-maxrate 30000 is allowed
&amp;ndash;vbv-bufsize 15000 &amp;ndash;vbv-maxrate 30000 is allowed
&amp;ndash;vbv-bufsize 30000 &amp;ndash;vbv-maxrate 15000 is not allowed (delay is greater than 1 second)&lt;/p&gt;

&lt;p&gt;Basicly vbv-bufsize should newer been greater than vbv-maxrate, that is whole point.&lt;/p&gt;

&lt;p&gt;&amp;ndash;sar
Simple Aspect Ratio, must present in stream, see the table for the appropriate settings&lt;/p&gt;

&lt;p&gt;&amp;ndash;slices
Only when encoding with &amp;ndash;level 4.1, slices need to be set to 4 or greater, otherwise you can skip this setting or set it to 1.&lt;/p&gt;

&lt;p&gt;-o xxx.264
Output file must be in raw 264 elementary stream (extension .264) otherwise settings will not applied correctly. DO NOT USE MKV OR MP4.&lt;/p&gt;

&lt;p&gt;2.2 OPTIONAL PARAMETERS&lt;/p&gt;

&lt;p&gt;This parameters is optional and not need for every encode.&lt;/p&gt;

&lt;p&gt;&amp;ndash;colorprim
&amp;ndash;transfer
&amp;ndash;colormatrix
Specify color primaries, transfer characteristics and color matrix. This is optional, and not need to be present, see the table for the appropriate settings.&lt;/p&gt;

&lt;p&gt;&amp;ndash;pic-struct
Need only when fake interlaced is used, and it&amp;rsquo;s default on with interlaced and pulldown. It&amp;rsquo;s fine with progressive aslo, and some BD verification tools request to be present in stream.&lt;/p&gt;

&lt;p&gt;&amp;ndash;open-gop
Use non-IDR pictures instead classic IDR picture, this will tend to resolve pulsing picture problem that is usually came with short GOP&amp;rsquo;s.&lt;/p&gt;

&lt;p&gt;&amp;ndash;fake-interlaced
Since 25p or 30p video is not allowed for Primary Video, encoding progressive video that meet Blu-Ray specification is only possible with this option. If use this option you aslo need to specify &amp;ndash;pic-struct&lt;/p&gt;

&lt;p&gt;&amp;ndash;qpfileNeed for chapters.&lt;/p&gt;

&lt;p&gt;2.2 EXAMPLES&lt;/p&gt;

&lt;p&gt;Progressive&lt;/p&gt;

&lt;p&gt;1080p (&lt;a href=&#34;http://www.x264bluray.com/home/1080i-p&#34;&gt;http://www.x264bluray.com/home/1080i-p&lt;/a&gt;)
720p (&lt;a href=&#34;http://www.x264bluray.com/home/720p-encoding&#34;&gt;http://www.x264bluray.com/home/720p-encoding&lt;/a&gt;)
576p (&lt;a href=&#34;http://www.x264bluray.com/home/576p-pal&#34;&gt;http://www.x264bluray.com/home/576p-pal&lt;/a&gt;)
480p (&lt;a href=&#34;http://www.x264bluray.com/home/480p-ntsc&#34;&gt;http://www.x264bluray.com/home/480p-ntsc&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Interlaced&lt;/p&gt;

&lt;p&gt;1080i (&lt;a href=&#34;http://www.x264bluray.com/home/1080i&#34;&gt;http://www.x264bluray.com/home/1080i&lt;/a&gt;)
576i (&lt;a href=&#34;http://www.x264bluray.com/home/576i-pal&#34;&gt;http://www.x264bluray.com/home/576i-pal&lt;/a&gt;)
480i (&lt;a href=&#34;http://www.x264bluray.com/home/480i-ntsc&#34;&gt;http://www.x264bluray.com/home/480i-ntsc&lt;/a&gt;)&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>H.264 Advanced Guide</title>
      <link>/guides/h264-advanced-guide/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/guides/h264-advanced-guide/</guid>
      <description>

&lt;p&gt;Source: &lt;a href=&#34;https://app.zencoder.com/docs/guides/encoding-settings/h264-advanced&#34;&gt;https://app.zencoder.com/docs/guides/encoding-settings/h264-advanced&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This page documents H.264-specific encoding with Zencoder. Zencoder encodes H.264 content using a variety of software, but our core encoder is the excellent x264, the best H.264 encoder available, and one of the best video encoding implementations for any codec. H.264 is the dominant video codec today for web and mobile video.&lt;/p&gt;

&lt;h2 id=&#34;h-264-overview&#34;&gt;H.264 Overview&lt;/h2&gt;

&lt;p&gt;The dominant video codec today for web and mobile video is H.264. Its compression quality ranks among the best of the modern codecs along with HEVC and VP9.&lt;/p&gt;

&lt;p&gt;H.264 can be played in 99.9% of web browsers, on many mobile devices (including the iPhone/iPad, Android), as well as many connected television and streaming devices. It is also an excellent codec for desktop video.&lt;/p&gt;

&lt;p&gt;H.264 is typically deployed in the MP4 file container. Valid extensions include .mp4, .m4v (mp4 video), .f4v (mp4 video for Flash) and .ts. Note that .flv is not a recommended file extension for H.264 Flash video — .f4v is preferred.&lt;/p&gt;

&lt;p&gt;AAC and MP3 audio codecs are valid alongside H.264.&lt;/p&gt;

&lt;h2 id=&#34;h-264-specific-notes-on-general-options&#34;&gt;H.264-specific notes on general options&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;crf&lt;/code&gt;: CRF is a bitrate-control setting, and sets a constant ratefactor. This is closely related to constant quantizer encoding, though CRF mode generally achieves better compression than constant Q encoding by reducing the quantizer quality on &amp;ldquo;less important&amp;rdquo; frames. Read more about crf.&lt;/p&gt;

&lt;p&gt;The Zencoder Quality setting determines an appropriate CRF for a given video. So if you set both Quality and CRF, the CRF setting will override Quality.&lt;/p&gt;

&lt;p&gt;Valid values are 0-51, with lower values being better quality. Generally speaking, you shouldn&amp;rsquo;t have to go below 16; 16 is nearly lossless for most files. Around 24 usually looks pretty good. Around 35 looks pretty compressed.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;video_codec_profile&lt;/code&gt;: The supported H.264 profiles are: baseline, main, high, high10, high422, high444. Lower levels are easier to decode, but higher levels offer better compression and extended features. For example, some older phones only supports the Baseline profile, which we use by default. The Main and High profiles are a definite step up in compression, and work fine for web playback. Try High for the best quality, and Baseline for mobile device support. Default: &amp;ldquo;baseline&amp;rdquo;.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;video_codec_level&lt;/code&gt;: constrains the bitrate and macroblocks. Primarily used for device compatibility. For example, the iPhone supports H.264 Level 3, which means that a video&amp;rsquo;s peak bitrate can&amp;rsquo;t exceed 10,000kbps. Only use this setting if you&amp;rsquo;re targeting a specific device that requires it. List of valid values. Default: 3.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;tuning&lt;/code&gt;: &amp;ldquo;tune&amp;rdquo; the output video to a specific content type. Useful values are &amp;ldquo;animation&amp;rdquo; for animated content, &amp;ldquo;film&amp;rdquo; for live-action content (not just movies), and &amp;ldquo;grain&amp;rdquo; to improve encoding of grainy content. Valid values: film, animation, grain, psnr, ssim, fastdecode, or zerolatency. Default: none.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;speed&lt;/code&gt;: Zencoder supports speed as a range from 1-5 for H.264. A lower speed results in slightly better compression, while a higher speed results in slightly worse compression.&lt;/p&gt;

&lt;h3 id=&#34;crf&#34;&gt;crf&lt;/h3&gt;

&lt;p&gt;CRF is a bitrate-control setting, and sets a constant ratefactor. This is closely related to constant quantizer encoding, though CRF mode generally achieves better compression than constant Q encoding by reducing the quantizer quality on &amp;ldquo;less important&amp;rdquo; frames. Read more about crf.&lt;/p&gt;

&lt;p&gt;The Zencoder Quality setting determines an appropriate CRF for a given video. So if you set both Quality and CRF, the CRF setting will override Quality.&lt;/p&gt;

&lt;p&gt;Valid values are 0-51, with lower values being better quality. Generally speaking, you shouldn&amp;rsquo;t have to go below 16; 16 is nearly lossless for most files. Around 24 usually looks pretty good. Around 35 looks pretty compressed.&lt;/p&gt;

&lt;h3 id=&#34;video-codec-profile&#34;&gt;video_codec_profile&lt;/h3&gt;

&lt;p&gt;Sets the encoding profile used by the video codec.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;H.264 profiles: baseline, main, high, high10, high422, high444.&lt;/li&gt;
&lt;li&gt;HEVC profiles: main, main10, main12, main422-10, main422-12, main444-8, main444-10, main444-12.&lt;/li&gt;
&lt;li&gt;VP9 profiles: 0, 1, 2, 3.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In general, lower levels are supported by a wider range of devices and may be simpler to decode. Higher levels offer more features such as additional bit depths and chroma subsampling choices. In some cases, higher levels also support increased compression efficiency.&lt;/p&gt;

&lt;h3 id=&#34;video-codec-level&#34;&gt;video_codec_level&lt;/h3&gt;

&lt;p&gt;Constrains bitrate, macroblocks (H.264) or bitrate, coding tree units (HEVC).&lt;/p&gt;

&lt;p&gt;Primarily used for device compatibility. For example, the iPhone supports H.264 Level 3, which means that a video’s decoder_bitrate_cap can’t exceed 10,000kbps. Typically, you should only change this setting if you’re targeting a specific device that requires it.&lt;/p&gt;

&lt;h3 id=&#34;decoder-bitrate-cap&#34;&gt;decoder_bitrate_cap&lt;/h3&gt;

&lt;p&gt;The max bitrate fed to the decoder via a buffer. This setting is typically used only for streaming (RTMP, HLS, or broadcast video).&lt;/p&gt;

&lt;p&gt;Only use this setting if you understand its implications, as it can decrease video quality.&lt;/p&gt;

&lt;h3 id=&#34;tuning&#34;&gt;tuning&lt;/h3&gt;

&lt;p&gt;Tune the output video to optimize for a specific content type, or a specific encoding priority.&lt;/p&gt;

&lt;p&gt;Behind the scenes, this sets the x264 &lt;code&gt;--tune&lt;/code&gt; option.&lt;/p&gt;

&lt;p&gt;Possible values:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;film - optimized for most non-animated video content (not only feature films).&lt;/li&gt;
&lt;li&gt;animation - optimized for animation. Note that most 3D animation behaves more like film and not like hand-drawn animation, so only use this for hand-drawn animation (anime, classic Disney, etc.).&lt;/li&gt;
&lt;li&gt;grain - optimized for film with high levels of grain.&lt;/li&gt;
&lt;li&gt;psnr - uses &amp;ldquo;peak signal-to-noise ratio&amp;rdquo; to optimize video quality.&lt;/li&gt;
&lt;li&gt;ssim - uses &amp;ldquo;structural similarity&amp;rdquo; to optimize video quality.&lt;/li&gt;
&lt;li&gt;fastdecode - reduces encoding complexity, to allow for easier decoding.&lt;/li&gt;
&lt;li&gt;zerolatency - x264 will keep an internal buffer of frames to improve quality; this setting removes that buffer, but reduces quality.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;speed&#34;&gt;speed&lt;/h3&gt;

&lt;p&gt;A target transcoding speed. Slower transcoding allows for more advanced file compression, while faster transcoding is possible by skipping some advanced compression features. Valid values are 1-5.&lt;/p&gt;

&lt;p&gt;Note: at the moment, only H.264 output has five speed levels. For VP6 content, 1-2 are a slower mode, and 3-5 are a faster mode. Other video codecs do not support this setting at all.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>